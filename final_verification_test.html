<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline'; object-src 'none';">
    <title>æœ€ç»ˆä¿®å¤éªŒè¯æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.2em;
        }
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-style: italic;
        }
        .test-section {
            margin: 25px 0;
            padding: 20px;
            border-left: 4px solid #3498db;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .test-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .test-description {
            color: #5a6c7d;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 8px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: white;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .btn-success { background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%); }
        .btn-warning { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        .log-container {
            margin-top: 30px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .log-entry {
            padding: 12px 16px;
            border-bottom: 1px solid #e1e8ed;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
        }
        .log-entry:last-child { border-bottom: none; }
        .log-success { background: #d4edda; color: #155724; }
        .log-error { background: #f8d7da; color: #721c24; }
        .log-info { background: #d1ecf1; color: #0c5460; }
        .log-warning { background: #fff3cd; color: #856404; }
        .checklist {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .checklist h3 {
            color: #2d5f2d;
            margin-top: 0;
        }
        .checklist ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .checklist li {
            margin: 8px 0;
            color: #2d5f2d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ æœ€ç»ˆä¿®å¤éªŒè¯æµ‹è¯•</h1>
        <div class="subtitle">éªŒè¯Chromeæ’ä»¶å¯¼å‡ºåŠŸèƒ½çš„æ‰€æœ‰ä¿®å¤æ˜¯å¦å®Œå…¨ç”Ÿæ•ˆ</div>

        <div class="checklist">
            <h3>âœ… éªŒè¯æ¸…å•</h3>
            <ul>
                <li><strong>CSPå…¼å®¹æ€§:</strong> æ— å†…è”äº‹ä»¶å¤„ç†å™¨ï¼Œæ‰€æœ‰äº‹ä»¶ä½¿ç”¨addEventListener</li>
                <li><strong>æ¨¡æ¿å­—ç¬¦ä¸²ä¿®å¤:</strong> ä¸æ˜¾ç¤º${å˜é‡}ç­‰JavaScriptä»£ç </li>
                <li><strong>å¼¹çª—ç¨³å®šæ€§:</strong> å¯¼å‡ºçª—å£æ­£å¸¸æ‰“å¼€ï¼Œæ— å¡é¡¿ï¼ŒæŒ‰é’®å“åº”æ­£å¸¸</li>
                <li><strong>èµ„æºç®¡ç†:</strong> æ­£ç¡®æ¸…ç†Blob URLï¼Œæ— å†…å­˜æ³„æ¼</li>
                <li><strong>é™çº§ä½“éªŒ:</strong> å¼¹çª—é˜»æ­¢æ—¶æä¾›å‹å¥½æç¤º</li>
            </ul>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸªŸ æµ‹è¯•1: æ ‡å‡†å¯¼å‡ºçª—å£</div>
            <div class="test-description">
                åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„URLå¯¼å‡ºçª—å£ï¼ŒéªŒè¯æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œç‰¹åˆ«æ³¨æ„æ˜¯å¦æ˜¾ç¤ºJavaScriptä»£ç ã€‚
            </div>
            <button class="btn btn-primary" id="testStandardExport">å¯åŠ¨æ ‡å‡†å¯¼å‡ºæµ‹è¯•</button>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ§ª æµ‹è¯•2: DOMæ–¹æ³•å¯¼å‡ºçª—å£</div>
            <div class="test-description">
                ä½¿ç”¨DOM createElementæ–¹æ³•æ„å»ºå¯¼å‡ºçª—å£ï¼Œå®Œå…¨é¿å…document.writeï¼Œæä¾›æœ€é«˜å®‰å…¨æ€§ã€‚
            </div>
            <button class="btn btn-success" id="testDOMExport">å¯åŠ¨DOMæ–¹æ³•æµ‹è¯•</button>
        </div>

        <div class="test-section">
            <div class="test-title">âš¡ æµ‹è¯•3: å¼¹çª—é˜»æ­¢é™çº§æµ‹è¯•</div>
            <div class="test-description">
                æ¨¡æ‹Ÿå¼¹çª—è¢«é˜»æ­¢çš„æƒ…å†µï¼ŒéªŒè¯é™çº§æ–¹æ¡ˆï¼ˆæ–‡ä»¶ä¸‹è½½ï¼‰æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚
            </div>
            <button class="btn btn-warning" id="testFallback">å¯åŠ¨é™çº§æµ‹è¯•</button>
        </div>

        <div class="log-container" id="logContainer">
            <div class="log-entry log-info">
                <strong>ğŸ“‹ æµ‹è¯•æ—¥å¿—</strong> - ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•ï¼Œç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º
            </div>
        </div>
    </div>

    <script>
        // æ—¥å¿—ç³»ç»Ÿ
        function addLog(message, type = 'info') {
            const container = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = 'log-entry log-' + type;
            
            const timestamp = new Date().toLocaleTimeString();
            entry.innerHTML = '<strong>[' + timestamp + ']</strong> ' + message;
            
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }

        // æµ‹è¯•æ•°æ®
        const testUrls = [
            'https://github.com/microsoft/vscode',
            'https://developer.mozilla.org/en-US/docs/Web/API',
            'https://stackoverflow.com/questions/tagged/javascript',
            'https://www.w3.org/TR/CSP3/',
            'https://web.dev/csp/'
        ];

        // æµ‹è¯•1: æ ‡å‡†å¯¼å‡ºçª—å£ï¼ˆæœ€ç»ˆä¿®å¤ï¼šåŸºäºLoadäº‹ä»¶çš„çº¯DOMæ“ä½œï¼‰
        function testStandardExport() {
            addLog('ğŸš€ å¼€å§‹æ ‡å‡†å¯¼å‡ºçª—å£æµ‹è¯• (Load Event + Pure DOM)...', 'info');
            
            try {
                // 1. æ‰“å¼€ä¸€ä¸ªå®Œå…¨ç©ºç™½çš„çª—å£ï¼Œä¸æŒ‡å®šURL
                const exportWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
                
                if (!exportWindow) {
                    addLog('âŒ å¼¹çª—è¢«æµè§ˆå™¨é˜»æ­¢ï¼Œå°è¯•é™çº§æ–¹æ¡ˆ...', 'warning');
                    fallbackDownload('standard_export_test.txt', testUrls.join('\n'));
                    return;
                }

                // 2. ç›‘å¬æ–°çª—å£çš„ 'load' äº‹ä»¶ï¼Œç¡®ä¿å…¶åˆå§‹æ–‡æ¡£å·²å‡†å¤‡å¥½
                exportWindow.addEventListener('load', function() {
                    try {
                        const doc = exportWindow.document;
                        const content = testUrls.join('\n');
                        const count = testUrls.length;

                        // --- ä½¿ç”¨çº¯DOMæ“ä½œæ„å»ºé¡µé¢ï¼Œå½»åº•é¿å…è§£æé—®é¢˜ ---

                        // 3. æ„å»º <head>
                        doc.title = 'æ ‡å‡†å¯¼å‡ºæµ‹è¯• - ' + count + 'ä¸ªURL';
                        const meta = doc.createElement('meta');
                        meta.setAttribute('charset', 'utf-8');
                        doc.head.appendChild(meta);

                        const style = doc.createElement('style');
                        style.textContent = 
                            'body { margin: 0; padding: 20px; font-family: system-ui, sans-serif; background: #f8f9fa; }' +
                            '.header { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; margin: -20px -20px 20px; text-align: center; }' +
                            '.container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }' +
                            'textarea { width: 100%; height: 300px; font-family: Monaco, monospace; font-size: 14px; border: 2px solid #e1e8ed; border-radius: 8px; padding: 15px; resize: vertical; }' +
                            '.stats { background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0; color: #1565c0; }' +
                            '.actions { text-align: center; margin-top: 20px; }' +
                            '.btn { padding: 12px 24px; margin: 0 8px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s; }' +
                            '.btn-primary { background: #007bff; color: white; }' +
                            '.btn-success { background: #28a745; color: white; }' +
                            '.btn-secondary { background: #6c757d; color: white; }' +
                            '.btn:hover { transform: translateY(-1px); opacity: 0.9; }';
                        doc.head.appendChild(style);

                        // 4. æ„å»º <body>
                        const headerDiv = doc.createElement('div');
                        headerDiv.className = 'header';
                        headerDiv.innerHTML = '<h2>ğŸ“‹ URLå¯¼å‡ºæµ‹è¯•</h2><p>æ ‡å‡†å­—ç¬¦ä¸²æ‹¼æ¥æ–¹æ³• - å·²ä¿®å¤æ¨¡æ¿å­—ç¬¦ä¸²æ˜¾ç¤ºé—®é¢˜</p>';
                        doc.body.appendChild(headerDiv);

                        const containerDiv = doc.createElement('div');
                        containerDiv.className = 'container';
                        doc.body.appendChild(containerDiv);

                        const statsDiv = doc.createElement('div');
                        statsDiv.className = 'stats';
                        statsDiv.innerHTML = 'ğŸ“Š <strong>ç»Ÿè®¡ä¿¡æ¯:</strong> å…±å¯¼å‡º ' + count + ' ä¸ªURLï¼Œå†…å®¹æ€»é•¿åº¦ ' + content.length + ' å­—ç¬¦';
                        containerDiv.appendChild(statsDiv);

                        const textarea = doc.createElement('textarea');
                        textarea.id = 'exportContent';
                        textarea.readOnly = true;
                        textarea.value = content;
                        containerDiv.appendChild(textarea);

                        const actionsDiv = doc.createElement('div');
                        actionsDiv.className = 'actions';
                        containerDiv.appendChild(actionsDiv);

                        const selectAllBtn = doc.createElement('button');
                        selectAllBtn.className = 'btn btn-primary';
                        selectAllBtn.textContent = 'ğŸ“‹ å…¨é€‰å†…å®¹';
                        actionsDiv.appendChild(selectAllBtn);

                        const copyBtn = doc.createElement('button');
                        copyBtn.className = 'btn btn-success';
                        copyBtn.textContent = 'ğŸ“„ å¤åˆ¶åˆ°å‰ªè´´æ¿';
                        actionsDiv.appendChild(copyBtn);

                        const closeBtn = doc.createElement('button');
                        closeBtn.className = 'btn btn-secondary';
                        closeBtn.textContent = 'âŒ å…³é—­çª—å£';
                        actionsDiv.appendChild(closeBtn);

                        // 5. ç»‘å®šäº‹ä»¶
                        selectAllBtn.addEventListener('click', function() {
                            textarea.select();
                            textarea.setSelectionRange(0, textarea.value.length);
                            addLog('âœ… å†…å®¹å·²é€‰ä¸­', 'success');
                        });

                        copyBtn.addEventListener('click', function() {
                            try {
                                textarea.select();
                                doc.execCommand('copy');
                                addLog('âœ… å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                            } catch (e) {
                                addLog('âš ï¸ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶', 'warning');
                            }
                        });

                        closeBtn.addEventListener('click', function() {
                            exportWindow.close();
                            addLog('ğŸ”š å¯¼å‡ºçª—å£å·²å…³é—­', 'info');
                        });
                        
                        // 6. è‡ªåŠ¨é€‰ä¸­å†…å®¹
                        exportWindow.focus();
                        textarea.focus();
                        textarea.select();
                        
                        addLog('âœ… å¯¼å‡ºçª—å£æ„å»ºå®Œæˆ (æœ€ç»ˆæ–¹æ¡ˆ)ï¼Œè¯·éªŒè¯æ•ˆæœ', 'success');

                    } catch (e) {
                        addLog('âŒ åœ¨loadäº‹ä»¶ä¸­æ„å»ºçª—å£å¤±è´¥: ' + e.message, 'error');
                    }
                }, { once: true }); // äº‹ä»¶åªæ‰§è¡Œä¸€æ¬¡
                
            } catch (error) {
                addLog('âŒ æ ‡å‡†å¯¼å‡ºæµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æµ‹è¯•2: DOMæ–¹æ³•å¯¼å‡ºçª—å£ (å·²ä¿®å¤)
        function testDOMExport() {
            addLog('ğŸš€ å¼€å§‹DOMæ–¹æ³•å¯¼å‡ºæµ‹è¯• (å·²ä¿®å¤)...', 'info');
            
            try {
                const exportWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
                
                if (!exportWindow) {
                    addLog('âŒ å¼¹çª—è¢«æµè§ˆå™¨é˜»æ­¢ï¼Œå°è¯•é™çº§æ–¹æ¡ˆ...', 'warning');
                    fallbackDownload('dom_export_test.txt', testUrls.join('\n'));
                    return;
                }

                // ä½¿ç”¨ 'load' äº‹ä»¶ç¡®ä¿æ–°çª—å£çš„æ–‡æ¡£å·²å®Œå…¨å‡†å¤‡å¥½
                exportWindow.addEventListener('load', function() {
                    try {
                        const doc = exportWindow.document;

                        // æ¸…ç† head å’Œ body çš„é»˜è®¤å†…å®¹ï¼Œè€Œä¸æ˜¯æ•´ä¸ª documentElement
                        doc.head.innerHTML = '';
                        doc.body.innerHTML = '';
                        
                        // --- ç›´æ¥åœ¨ç°æœ‰çš„ head å’Œ body ä¸­æ„å»ºé¡µé¢ ---

                        // 1. æ„å»º <head>
                        doc.title = 'DOMæ–¹æ³•å¯¼å‡ºæµ‹è¯•';
                        
                        const charset = doc.createElement('meta');
                        charset.setAttribute('charset', 'utf-8');
                        doc.head.appendChild(charset);
                        
                        const style = doc.createElement('style');
                        style.textContent = 
                            'body { margin: 0; padding: 20px; font-family: system-ui, sans-serif; background: #f0f4f8; }' +
                            '.header { background: linear-gradient(135deg, #56ab2f, #a8e6cf); color: white; padding: 20px; margin: -20px -20px 20px; text-align: center; }' +
                            '.container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }' +
                            'textarea { width: 100%; height: 300px; font-family: "SF Mono", Monaco, monospace; font-size: 14px; border: 2px solid #a8e6cf; border-radius: 8px; padding: 15px; resize: vertical; }' +
                            '.method-info { background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 15px 0; color: #2d5f2d; }' +
                            '.actions { text-align: center; margin-top: 20px; }' +
                            '.btn { padding: 12px 24px; margin: 0 8px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s; }' +
                            '.btn-success { background: #28a745; color: white; }' +
                            '.btn-info { background: #17a2b8; color: white; }' +
                            '.btn-secondary { background: #6c757d; color: white; }' +
                            '.btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }';
                        doc.head.appendChild(style);
                        
                        // 2. æ„å»º <body>
                        const header = doc.createElement('div');
                        header.className = 'header';
                        header.innerHTML = '<h2>ğŸ› ï¸ DOMæ–¹æ³•å¯¼å‡ºæµ‹è¯•</h2><p>ä½¿ç”¨createElementæ„å»ºï¼Œæœ€é«˜å®‰å…¨çº§åˆ«</p>';
                        doc.body.appendChild(header);
                        
                        const container = doc.createElement('div');
                        container.className = 'container';
                        
                        const methodInfo = doc.createElement('div');
                        methodInfo.className = 'method-info';
                        methodInfo.innerHTML = 'ğŸ”§ <strong>æ„å»ºæ–¹æ³•:</strong> æ­¤çª—å£å®Œå…¨ä½¿ç”¨DOM createElementæ–¹æ³•æ„å»ºï¼Œä¸ä½¿ç”¨document.writeï¼Œæä¾›æœ€é«˜çš„å®‰å…¨æ€§å’Œå…¼å®¹æ€§ã€‚';
                        container.appendChild(methodInfo);
                        
                        const textarea = doc.createElement('textarea');
                        textarea.id = 'exportContent';
                        textarea.readOnly = true;
                        textarea.value = testUrls.join('\n');
                        container.appendChild(textarea);
                        
                        const actions = doc.createElement('div');
                        actions.className = 'actions';
                        
                        const selectBtn = doc.createElement('button');
                        selectBtn.className = 'btn btn-success';
                        selectBtn.innerHTML = 'ğŸ“‹ å…¨é€‰å†…å®¹';
                        selectBtn.addEventListener('click', function() {
                            textarea.select();
                            textarea.setSelectionRange(0, textarea.value.length);
                            addLog('âœ… DOMæ–¹æ³•çª—å£å†…å®¹å·²é€‰ä¸­', 'success');
                        });
                        actions.appendChild(selectBtn);
                        
                        const copyBtn = doc.createElement('button');
                        copyBtn.className = 'btn btn-info';
                        copyBtn.innerHTML = 'ğŸ“„ å¤åˆ¶å†…å®¹';
                        copyBtn.addEventListener('click', function() {
                            try {
                                textarea.select();
                                doc.execCommand('copy');
                                addLog('âœ… DOMæ–¹æ³•çª—å£å†…å®¹å·²å¤åˆ¶', 'success');
                            } catch (e) {
                                addLog('âš ï¸ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'warning');
                            }
                        });
                        actions.appendChild(copyBtn);
                        
                        const closeBtn = doc.createElement('button');
                        closeBtn.className = 'btn btn-secondary';
                        closeBtn.innerHTML = 'âŒ å…³é—­çª—å£';
                        closeBtn.addEventListener('click', function() {
                            exportWindow.close();
                            addLog('ğŸ”š DOMæ–¹æ³•çª—å£å·²å…³é—­', 'info');
                        });
                        actions.appendChild(closeBtn);
                        
                        container.appendChild(actions);
                        doc.body.appendChild(container);
                        
                        // 3. è‡ªåŠ¨é€‰ä¸­å†…å®¹
                        exportWindow.focus();
                        textarea.focus();
                        textarea.select();
                        
                        addLog('âœ… DOMæ–¹æ³•å¯¼å‡ºçª—å£åˆ›å»ºæˆåŠŸ (å·²ä¿®å¤)ï¼Œå®Œå…¨é¿å…æ ¹å…ƒç´ å†²çª', 'success');

                    } catch (e) {
                        addLog('âŒ åœ¨loadäº‹ä»¶ä¸­æ„å»ºDOMçª—å£å¤±è´¥: ' + e.message, 'error');
                    }
                }, { once: true });
                
            } catch (error) {
                addLog('âŒ DOMæ–¹æ³•å¯¼å‡ºæµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æµ‹è¯•3: é™çº§æ–¹æ¡ˆæµ‹è¯•
        function testFallback() {
            addLog('ğŸš€ å¼€å§‹é™çº§æ–¹æ¡ˆæµ‹è¯•...', 'info');
            addLog('â„¹ï¸ æ¨¡æ‹Ÿå¼¹çª—è¢«é˜»æ­¢ï¼Œç›´æ¥è§¦å‘æ–‡ä»¶ä¸‹è½½...', 'info');
            
            try {
                const content = '# URLå¯¼å‡ºæµ‹è¯•æ–‡ä»¶\n\n' +
                    'å¯¼å‡ºæ—¶é—´: ' + new Date().toLocaleString() + '\n' +
                    'æ€»æ•°é‡: ' + testUrls.length + ' ä¸ªURL\n\n' +
                    '## URLåˆ—è¡¨\n\n' +
                    testUrls.map((url, index) => (index + 1) + '. ' + url).join('\n') + '\n\n' +
                    '## è¯´æ˜\n' +
                    'æ­¤æ–‡ä»¶ç”±Chromeæ’ä»¶é™çº§æ–¹æ¡ˆè‡ªåŠ¨ç”Ÿæˆã€‚\n' +
                    'å½“å¼¹çª—è¢«æµè§ˆå™¨é˜»æ­¢æ—¶ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°æ–‡ä»¶ä¸‹è½½æ¨¡å¼ã€‚';
                
                fallbackDownload('fallback_test.txt', content);
                addLog('âœ… é™çº§æ–¹æ¡ˆæµ‹è¯•å®Œæˆï¼Œæ–‡ä»¶ä¸‹è½½å·²è§¦å‘', 'success');
                
            } catch (error) {
                addLog('âŒ é™çº§æ–¹æ¡ˆæµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            }
        }

        // é™çº§ä¸‹è½½æ–¹æ¡ˆ
        function fallbackDownload(filename, content) {
            try {
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                link.style.display = 'none';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // æ¸…ç†èµ„æº
                setTimeout(function() {
                    URL.revokeObjectURL(url);
                }, 1000);
                
                addLog('ğŸ“¥ æ–‡ä»¶ä¸‹è½½è§¦å‘: ' + filename, 'success');
                
            } catch (error) {
                addLog('âŒ é™çº§ä¸‹è½½å¤±è´¥: ' + error.message, 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåç»‘å®šäº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            addLog('ğŸ¯ æœ€ç»ˆä¿®å¤éªŒè¯æµ‹è¯•é¡µé¢å·²åŠ è½½', 'success');
            addLog('ğŸ’¡ è¯·ä¾æ¬¡ç‚¹å‡»ä¸Šæ–¹æµ‹è¯•æŒ‰é’®ï¼ŒéªŒè¯æ‰€æœ‰ä¿®å¤æ˜¯å¦ç”Ÿæ•ˆ', 'info');
            
            const testStandardBtn = document.getElementById('testStandardExport');
            const testDOMBtn = document.getElementById('testDOMExport');
            const testFallbackBtn = document.getElementById('testFallback');
            
            if (testStandardBtn) {
                testStandardBtn.addEventListener('click', testStandardExport);
            }
            
            if (testDOMBtn) {
                testDOMBtn.addEventListener('click', testDOMExport);
            }
            
            if (testFallbackBtn) {
                testFallbackBtn.addEventListener('click', testFallback);
            }
        });
    </script>
</body>
</html>
