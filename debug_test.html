<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简单XPath测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            border: 1px solid #ccc;
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
        }
        .debug-info {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>XPath提取器调试页面</h1>
    
    <div class="debug-info">
        <strong>当前页面URL:</strong> <span id="currentUrl"></span><br>
        <strong>页面加载时间:</strong> <span id="loadTime"></span>
    </div>

    <div class="test-section">
        <h2>基础链接测试</h2>
        <p>测试XPath: <code>//a/@href</code></p>
        <ul>
            <li><a href="/page1.html">站内链接1</a></li>
            <li><a href="page2.html">站内链接2</a></li>
            <li><a href="https://www.baidu.com">外部链接1</a></li>
            <li><a href="https://www.google.com">外部链接2</a></li>
        </ul>
    </div>

    <div class="test-section">
        <h2>图片测试</h2>
        <p>测试XPath: <code>//img/@src</code></p>
        <img src="/images/test1.jpg" alt="测试图片1" width="50" height="50">
        <img src="test2.jpg" alt="测试图片2" width="50" height="50">
        <img src="https://via.placeholder.com/50x50/ff0000/ffffff?text=IMG" alt="外部图片">
    </div>

    <div class="test-section">
        <h2>手动XPath测试</h2>
        <p>在浏览器控制台中运行以下命令测试：</p>
        <div class="debug-info">
            <div>// 测试所有链接</div>
            <div>console.log('链接数量:', $x('//a').length);</div>
            <div>console.log('href属性:', $x('//a/@href').map(attr => attr.value));</div>
            <br>
            <div>// 测试所有图片</div>
            <div>console.log('图片数量:', $x('//img').length);</div>
            <div>console.log('src属性:', $x('//img/@src').map(attr => attr.value));</div>
            <br>
            <div>// 测试document.evaluate方法</div>
            <div>const result = document.evaluate('//a/@href', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);</div>
            <div>console.log('evaluate结果数量:', result.snapshotLength);</div>
            <div>for(let i = 0; i < result.snapshotLength; i++) {</div>
            <div>&nbsp;&nbsp;console.log('URL ' + i + ':', result.snapshotItem(i).value);</div>
            <div>}</div>
        </div>
    </div>

    <div class="test-section">
        <h2>页面元素统计</h2>
        <div id="elementStats"></div>
    </div>

    <script>
        // 显示当前页面信息
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('loadTime').textContent = new Date().toLocaleString();

        // 统计页面元素
        function updateElementStats() {
            const stats = {
                'a标签数量': document.querySelectorAll('a').length,
                'img标签数量': document.querySelectorAll('img').length,
                'href属性数量': document.querySelectorAll('[href]').length,
                'src属性数量': document.querySelectorAll('[src]').length
            };

            const statsDiv = document.getElementById('elementStats');
            statsDiv.innerHTML = Object.entries(stats)
                .map(([key, value]) => `<div><strong>${key}:</strong> ${value}</div>`)
                .join('');
        }

        // 页面加载完成后更新统计
        document.addEventListener('DOMContentLoaded', updateElementStats);

        // 测试XPath函数
        function testXPath(xpath) {
            try {
                const result = document.evaluate(
                    xpath,
                    document,
                    null,
                    XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,
                    null
                );
                
                console.log(`XPath "${xpath}" 匹配结果:`, result.snapshotLength);
                
                for (let i = 0; i < result.snapshotLength; i++) {
                    const node = result.snapshotItem(i);
                    if (node.nodeType === Node.ATTRIBUTE_NODE) {
                        console.log(`  ${i}: ${node.name} = ${node.value}`);
                    } else {
                        console.log(`  ${i}: ${node.tagName || node.nodeName} = ${node.textContent || node.value}`);
                    }
                }
                
                return result.snapshotLength;
            } catch (error) {
                console.error(`XPath "${xpath}" 错误:`, error);
                return -1;
            }
        }

        // 自动测试常用XPath
        window.addEventListener('load', function() {
            console.log('=== 自动XPath测试开始 ===');
            console.log('页面URL:', window.location.href);
            
            const testCases = [
                '//a/@href',
                '//img/@src',
                '//a',
                '//img',
                '//*[@href]/@href',
                '//*[@src]/@src'
            ];
            
            testCases.forEach(xpath => {
                const count = testXPath(xpath);
                console.log(`${xpath}: ${count} 个匹配`);
            });
            
            console.log('=== 自动XPath测试结束 ===');
        });
    </script>
</body>
</html>
