# 🎯 智能内容提取器 Chrome插件

> 一个功能强大的Chrome浏览器插件，专门用于根据自定义XPath规则智能提取网页中的URL链接或文本内容，支持自动模式识别

[![Manifest V3](https://img.shields.io/badge/Manifest-V3-green.svg)](https://developer.chrome.com/d## 更新日志

### v1.2.0 (2025-07-27) - 智能内容识别版本
- 🧠 **新增智能模式识别** - 自动识别URL模式和文本模式，采用不同处理策略
- 🔗 **增强URL格式支持** - 支持复杂查询参数、锚点等URL格式
- 🛡️ **严格相对路径规则** - 只支持`/`开头的站内相对路径，`./`和`../`判定为文本模式
- 📊 **优化状态提示** - 显示"URL模式：成功提取 X 个URL"或"文本模式：成功提取 X 个文本项"
- 🧹 **移除调试信息** - 清理控制台输出，提升用户体验
- 📝 **更新界面文本** - 按钮改为"提取内容"，适应新的双模式功能
- 🎨 **详情页面适配** - 支持文本内容展示和模式信息显示
- 🧪 **新增测试页面** - 提供完整的模式识别测试用例

### v1.1.0 (2025-07-26) - 稳定性增强版本
- 🔧 **修复存储兼容性问题** - 解决了"Cannot read properties of undefined (reading 'local')"错误
- 🔄 **增强存储降级机制** - Chrome Storage API不可用时自动降级到localStorage
- 🛡️ **改进错误处理** - 所有存储操作都有完整的兼容性检查和错误处理
- 📋 **优化API检测** - 增强Chrome Storage API可用性检测逻辑
- 🔘 **修复详情弹窗按钮** - 解决复制全部URL、导出为文本、单个复制按钮不工作问题
- 🔄 **多重降级机制** - 剪贴板功能和下载功能都有完整的降级方案
- 📖 **完善故障排除文档** - 添加详细的问题诊断和解决方案
- 🧪 **新增测试页面** - details_test.html 用于测试详情功能兼容性

### v1.0.0 (2025-07-25) - 初始版本
- 🎯 **基础URL提取功能** - 支持XPath规则提取网页链接
- 🔗 **相对路径补全** - 自动处理站内相对路径和协议相对路径
- 💾 **规则管理系统** - 保存、管理自定义XPath规则
- 📋 **批量操作支持** - 复制、导出多种格式
- 🎨 **现代化界面** - 紫色渐变主题，响应式设计/)
[![Chrome Extension](https://img.shields.io/badge/Chrome-Extension-blue.svg)](https://chrome.google.com/webstore)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## ✨ 核心特性

### 🧠 智能模式识别
- **自动模式检测**: 根据XPath提取结果自动识别URL模式或文本模式
- **URL模式**: 所有结果符合URL格式时自动处理相对路径补全
- **文本模式**: 包含非URL内容时保持原始文本不变
- **清晰状态提示**: 显示"URL模式：成功提取 X 个URL"或"文本模式：成功提取 X 个文本项"

### 🔍 智能内容提取
- **XPath规则支持**: 使用强大的XPath表达式精确定位目标内容
- **相对路径智能补全**: 自动处理站内相对路径（/开头）和协议相对路径（//开头）
- **复杂URL支持**: 支持带查询参数、锚点的复杂路径格式
- **内容去重和规范化**: 智能去除重复内容，输出清洁结果
- **实时提取预览**: 即时查看匹配数量和提取效果

### 🎨 现代化界面
- **精美UI设计**: 紫色渐变主题，现代化卡片布局
- **流畅动画效果**: 悬停动画、加载状态、通知提示
- **详情页面优化**: 绿色编号徽章 + 橙色胶囊复制按钮
- **响应式布局**: 适配各种屏幕尺寸

### 📋 管理功能
- **自定义规则保存**: 保存常用XPath规则，支持命名和分类
- **使用统计**: 追踪规则使用频率，智能排序
- **内置规则库**: 预设常用提取规则，一键应用
- **批量操作**: 支持多种分隔符的批量复制

### 🔒 安全可靠
- **Manifest V3兼容**: 符合最新Chrome扩展标准
- **CSP安全合规**: 完全符合内容安全策略
- **权限最小化**: 仅请求必要的浏览器权限
- **双重存储**: Chrome Storage + LocalStorage降级策略

## 安装方法

1. 下载或克隆此项目
2. 打开Chrome浏览器，进入 `chrome://extensions/`
3. 开启"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择项目文件夹

## 使用说明

### 基本使用

1. 点击浏览器工具栏中的插件图标
2. 在XPath输入框中输入规则（默认为 `//a/@href`）
3. 点击"提取内容"按钮
4. 观察状态提示，了解识别的模式（URL模式或文本模式）
5. 使用"复制全部"按钮将内容复制到剪贴板
6. 使用"查看详情"按钮在新窗口中查看所有提取结果

### XPath规则管理

#### 保存自定义规则
1. 在XPath输入框中输入自定义规则
2. 点击"💾 保存"按钮
3. 输入规则名称（如："商品链接"、"新闻标题"等）
4. 规则将永久保存，可重复使用

#### 管理已保存规则
1. 点击"📋 管理"按钮打开管理界面
2. 查看所有已保存的规则及其统计信息
3. 使用"使用"按钮快速应用规则
4. 使用"删除"按钮移除不需要的规则
5. 规则按创建时间排序，显示使用次数

#### 预设规则增强
- 预设规则现在包含内置规则和自定义规则
- 自定义规则按使用频率排序
- 显示每个规则的使用统计

### XPath规则示例

| 用途 | XPath规则 | 说明 |
|------|-----------|------|
| 所有链接 | `//a/@href` | 提取所有a标签的href属性 |
| 所有图片 | `//img/@src` | 提取所有img标签的src属性 |
| 外部链接 | `//a[starts-with(@href, "http")]/@href` | 只提取外部链接 |
| 站内链接 | `//a[starts-with(@href, "/")]/@href` | 只提取根目录相对链接 |
| CSS文件 | `//link[@rel="stylesheet"]/@href` | 提取所有CSS文件链接 |
| JS文件 | `//script/@src` | 提取所有JavaScript文件链接 |

### 高级功能

- **智能模式识别**: 插件自动分析提取结果，选择最适合的处理模式
- **预设规则**: 点击输入框右侧的"预设"按钮选择常用规则
- **相对路径补全**: URL模式下自动将站内相对路径转换为完整URL
- **去重处理**: 自动去除重复的内容，保证结果唯一性
- **多种分隔符**: 支持换行符、空格、逗号等多种分隔符的批量复制

### 🧠 智能模式识别说明

#### 模式识别规则
插件会根据XPath提取的内容自动识别处理模式：

**URL模式判断条件**：
- 所有提取结果去除首尾空格后必须都符合URL格式
- 支持绝对URL（http://、https://开头）
- 支持站内相对路径（以 `/` 开头的根目录形式，包括复杂路径和查询参数）
- 支持协议相对路径（以 `//` 开头）
- 不支持当前目录相对路径（`./`）和上级目录相对路径（`../`），这些会被判定为文本模式
- 如果有任何一个结果不符合URL格式，则判定为文本模式

**处理方式**：
- **URL模式**：自动补全相对路径为绝对路径，去重并规范化
- **文本模式**：保持原始内容不变，仅进行去重处理

#### 状态提示信息
提取完成后，状态栏会显示：
- **URL模式**：`URL模式：成功提取 X 个URL`
- **文本模式**：`文本模式：成功提取 X 个文本项`

### 📝 使用示例

#### URL模式示例
```xpath
//a/@href                    // 提取所有链接 → URL模式
//img/@src                   // 提取所有图片 → URL模式  
//link[@rel="stylesheet"]/@href  // 提取CSS文件 → URL模式
```

**支持的URL格式**：
- `https://example.com/page` - 绝对URL
- `/user/profile/123` - 根目录相对路径
- `/api/data?id=123&token=abc` - 带查询参数的路径
- `//cdn.example.com/script.js` - 协议相对路径

#### 文本模式示例
```xpath
//h1/text()                  // 提取标题文本 → 文本模式
//p/text()                   // 提取段落文本 → 文本模式
//div[@class="content"]//text()  // 提取内容文本 → 文本模式
```

#### 混合内容（会触发文本模式）
```xpath
//div//text()                // 可能包含链接文本和普通文本 → 文本模式
//a[contains(@href, "./")]/@href  // 包含当前目录相对路径 → 文本模式
```

## 技术特点

- **Manifest V3兼容**: 使用最新的Chrome扩展标准
- **智能内容识别**: 自动区分URL和文本内容，采用不同处理策略
- **复杂URL支持**: 支持带查询参数、锚点的复杂路径格式
- **双重存储策略**: Chrome Storage + LocalStorage降级保障
- **现代化UI设计**: 响应式布局，流畅动画效果
- **完善错误处理**: 全面的异常处理和用户提示
- **无控制台污染**: 移除调试信息，保持控制台整洁

## 文件结构

```
batchGetUrl/
├── manifest.json                    # 插件配置文件
├── popup.html                      # 弹窗界面
├── popup.js                        # 弹窗逻辑（智能模式识别）
├── content.js                      # 内容脚本
├── background.js                   # 后台脚本
├── details.html                    # 详情页面
├── details.js                      # 详情页面逻辑
├── details.css                     # 详情页面样式
├── test_content_extraction.html    # 功能测试页面
├── icons/                          # 图标文件夹
└── README.md                       # 说明文档
```

## 权限说明

- `activeTab`: 访问当前活动标签页
- `scripting`: 在页面中执行脚本
- `clipboardWrite`: 写入剪贴板

## 兼容性

- Chrome 88+
- Edge 88+
- 其他基于Chromium的浏览器

## 更新日志

### v1.1.0 (2025-07-26)
- 🔧 **修复存储兼容性问题** - 解决了"Cannot read properties of undefined (reading 'local')"错误
- 🔄 **增强存储降级机制** - Chrome Storage API不可用时自动降级到localStorage
- 🛡️ **改进错误处理** - 所有存储操作都有完整的兼容性检查和错误处理
- 📋 **优化API检测** - 增强Chrome Storage API可用性检测逻辑
- � **修复详情弹窗按钮** - 解决复制全部URL、导出为文本、单个复制按钮不工作问题
- 🔄 **多重降级机制** - 剪贴板功能和下载功能都有完整的降级方案
- �📖 **完善故障排除文档** - 添加详细的问题诊断和解决方案
- 🧪 **新增测试页面** - details_test.html 用于测试详情功能兼容性

### v1.0.0
- 初始版本发布
- 基本的URL提取功能
- XPath规则支持
- 路径补全功能
- 复制和查看功能

## 常见问题

**Q: 保存XPath规则时提示"保存失败: Cannot read properties of undefined (reading 'local')"怎么办？**
A: 这是存储API兼容性问题，插件已内置自动降级机制：
- 确保插件权限正确配置
- 重新加载插件尝试修复
- 插件会自动使用localStorage作为备用存储
- 详细解决方案请查看TROUBLESHOOTING.md文档

**Q: 详情弹窗中的复制和导出按钮不工作怎么办？**
A: 这通常是浏览器安全策略导致的，插件已内置多重降级机制：
- 使用HTTPS环境或localhost进行测试
- 检查浏览器剪贴板和下载权限设置
- 插件会自动降级到execCommand或手动复制方案
- 使用debug_details.html页面进行详细测试和诊断
- 详细排查步骤请查看DETAILS_TROUBLESHOOTING.md文档

**Q: XPath规则不工作怎么办？**
A: 请检查XPath语法是否正确，可以使用浏览器开发者工具的控制台测试。

**Q: 为什么有些相对路径没有被正确补全？**
A: 插件会尽力补全相对路径，但某些复杂的路径可能需要手动调整XPath规则。

**Q: 如何提取特定区域的链接？**
A: 使用更精确的XPath规则，例如 `//div[@class="content"]//a/@href`。

## 技术支持

如有问题或建议，请通过以下方式联系：
- GitHub Issues
- 邮件支持

## 许可证

MIT License

### 🧠 智能模式识别说明

#### 模式识别规则
插件会根据XPath提取的内容自动识别处理模式：

**URL模式判断条件**：
- 所有提取结果去除首尾空格后必须都符合URL格式
- 支持绝对URL（http://、https://开头）
- 支持站内相对路径（以 `/` 开头的根目录形式，包括复杂路径和查询参数）
- 支持协议相对路径（以 `//` 开头）
- 不支持当前目录相对路径（`./`）和上级目录相对路径（`../`），这些会被判定为文本模式
- 如果有任何一个结果不符合URL格式，则判定为文本模式

**处理方式**：
- **URL模式**：自动补全相对路径为绝对路径，去重并规范化
- **文本模式**：保持原始内容不变，仅进行去重处理

#### 状态栏信息
提取完成后，状态栏会显示：
- 提取的内容数量和类型（URL或文本项）
- 模式识别详情（如："URL模式：5个URL（3个绝对路径，2个相对路径已补全）"）
- 错误信息（如果XPath规则有问题）

### 📝 使用示例

#### URL模式示例
```xpath
//a/@href                    // 提取所有链接 → URL模式
//img/@src                   // 提取所有图片 → URL模式  
//link[@rel="stylesheet"]/@href  // 提取CSS文件 → URL模式
```

**支持的URL格式**：
- `https://example.com/page` - 绝对URL
- `/user/profile/123` - 根目录相对路径
- `/api/data?id=123&token=abc` - 带查询参数的路径
- `//cdn.example.com/script.js` - 协议相对路径

#### 文本模式示例
```xpath
//h1/text()                  // 提取标题文本 → 文本模式
//p/text()                   // 提取段落文本 → 文本模式
//div[@class="content"]//text()  // 提取内容文本 → 文本模式
```

#### 混合内容（会触发文本模式）
```xpath
//div//text()                // 可能包含链接文本和普通文本 → 文本模式
```

## 💡 使用技巧

### XPath编写技巧
- 使用浏览器开发者工具（F12）来测试XPath表达式
- 在Elements面板中右键元素 → Copy → Copy XPath 获取基础XPath
- 使用 `//` 开头进行全局搜索，使用 `/` 开头进行精确路径匹配
- 利用属性筛选：`//a[@class="link"]/@href` 只提取特定class的链接

### 模式识别优化
- 如果希望强制使用URL模式，确保XPath只提取href、src等URL属性
- 如果希望提取文本内容，使用 `//element/text()` 或 `//element/@title` 等
- 混合内容会自动判定为文本模式，适合提取包含各种内容的列表

### 性能优化建议
- 避免过于宽泛的XPath表达式，如 `//*` 
- 优先使用具体的标签名和属性进行定位
- 对于大型页面，使用更精确的选择器提高提取速度

## ⚠️ 注意事项

- 某些网站可能有反爬虫机制，请合理使用
- 动态加载的内容可能需要等待页面完全加载后再提取
- 跨域限制可能影响某些页面的提取功能
- 建议在使用前先用测试页面验证XPath表达式的正确性

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

1. Fork此项目
2. 创建feature分支：`git checkout -b feature/amazing-feature`
3. 提交更改：`git commit -m 'Add amazing feature'`
4. 推送分支：`git push origin feature/amazing-feature`
5. 提交Pull Request

## 📄 许可证

此项目使用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🙏 致谢

感谢所有贡献者和用户的支持！

---

*如有问题或建议，请提交Issue或联系开发者。*
